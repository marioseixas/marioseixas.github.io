// Color Palette (WCAG AA Compliant)
$colors: (
  background: #2C2C2C,
  text: #E0E0E0,
  headings: #F39C12,
  links: (
    default: #2ECC71,
    visited: #1ABC9C,
    hover: #3498DB
  ),
  accents: (
    amethyst: #9B59B6,
    dodgerblue: #3498DB,
    turquoise: #1ABC9C
  ),
  highlights: (
    crimson: #E74C3C,
    pumpkin: #D35400
  ),
  code: (
    background: #34495E,
    text: #1ABC9C
  )
);

// Typography
$font-family-main: 'BitPotionExt', sans-serif;
$font-family-code: 'BitPotionExt', monospace;
$line-height-base: 1.5;
$font-size-base: 16px;

// Mixins and Functions
@function color($key, $subkey: null) {
  @if $subkey {
    @return map-get(map-get($colors, $key), $subkey);
  }
  @return map-get($colors, $key);
}

@function strip-unit($value) {
  @return $value / ($value * 0 + 1);
}

@mixin responsive-font($min-size, $max-size, $min-vw: 320px, $max-vw: 1200px) {
  $min-size-rem: strip-unit($min-size) / 16 * 1rem;
  $max-size-rem: strip-unit($max-size) / 16 * 1rem;
  $min-vw-rem: strip-unit($min-vw) / 16 * 1rem;
  $max-vw-rem: strip-unit($max-vw) / 16 * 1rem;
  
  font-size: clamp(#{$min-size-rem}, calc(#{$min-size-rem} + #{strip-unit($max-size-rem - $min-size-rem)} * (100vw - #{$min-vw-rem}) / #{strip-unit($max-vw-rem - $min-vw-rem)}), #{$max-size-rem});
}

// Base Styles
html {
  box-sizing: border-box;
  font-size: $font-size-base;
}

*, *::before, *::after {
  box-sizing: inherit;
}

body {
  font-family: $font-family-main;
  background-color: color(background);
  color: color(text);
  line-height: $line-height-base;
  margin: 0 auto;
  max-width: 40em;
  padding: 1em;
  @include responsive-font(16px, 20px);
}

// Typography
@for $i from 1 through 6 {
  h#{$i} {
    color: color(headings);
    margin: 1em 0 0.5em;
    line-height: 1.2;
    font-size: #{2.5rem / $i};
  }
}

a {
  color: color(links, default);
  transition: color 0.3s ease;

  &:visited { color: color(links, visited); }
  &:hover, &:focus { color: color(links, hover); }
}

p {
  text-align: justify;
  hyphens: auto;
}

// Code styles
%code-base {
  font-family: $font-family-code;
  background: color(code, background);
  color: color(code, text);
  padding: 0.2em 0.4em;
  border-radius: 4px;
  overflow-x: auto;
  white-space: pre-wrap;
  word-break: break-word;
  overflow-wrap: break-word;
}

pre, code {
  @extend %code-base;
  @include responsive-font(14px, 18px);
}

:not(pre) > code, kbd, samp, tt {
  @extend %code-base;
  @include responsive-font(12px, 16px);
}

// Responsive elements
img, canvas, iframe, video, svg, select, textarea {
  max-width: 100%;
  height: auto;
}

// Tables
table {
  border-collapse: collapse;
  width: 100%;
}

th, td {
  padding: 0.5em 1em;
  text-align: left;
  border: 1px dotted color(accents, amethyst);
}

th, thead, tfoot {
  background: color(headings);
  font-weight: bold;
  color: color(background);
}

// Forms
textarea {
  display: block;
  width: 100%;
}

input, textarea, select, button {
  font-family: inherit;
  font-size: 100%;
  margin: 0.2em 0;
}

// Images and figures
img {
  &[align="right"] { margin-left: 1em; }
  &[align="left"] { margin-right: 1em; }
}

figcaption {
  font: caption;
  color: color(accents, amethyst);
  font-size: 75%;
}

// SVG and icons
%icon-size {
  max-height: 30px;
  vertical-align: middle;
}

*[class*="social"] svg, 
*[class*="icon"] svg, 
svg[class*="icon"], 
img[class*="emoji"][src$=".svg"] {
  @extend %icon-size;
}

*[class*="logo" i] svg, 
img[src*="logo" i] {
  max-height: 70px;
  vertical-align: middle;
}

// Custom components
.comment-box {
  @include responsive-font(13px, 16px);
  margin: 1.25rem 0 0.625rem;
  line-height: 1.25;
  border: 1px dotted color(accents, dodgerblue);
  padding: 0.3125rem 1.25rem;
  border-radius: 0.1875rem;
  background-color: rgba(color(accents, dodgerblue), 0.1);
}

.search-link {
  display: inline-block;
  @include responsive-font(24px, 48px);
  border: 1px dotted color(accents, dodgerblue);
  border-radius: 0.1875rem;
  background-color: rgba(color(accents, dodgerblue), 0.1);
  padding: 0.5em;
  transition: all 0.3s ease;

  &:hover, &:focus {
    background-color: rgba(color(accents, dodgerblue), 0.2);
    transform: scale(1.05);
  }
}

blockquote {
  padding-left: 1em;
  margin-left: 0;
  border-left: 5px solid color(accents, dodgerblue);
  background-color: rgba(color(accents, dodgerblue), 0.1);
}

// Accessibility
.visually-hidden {
  position: absolute !important;
  height: 1px;
  width: 1px;
  overflow: hidden;
  clip: rect(1px, 1px, 1px, 1px);
  white-space: nowrap;
}

::selection {
  background-color: color(code, background);
  color: color(code, text);
}

// Print styles
@media print {
  body {
    background-color: #FFFFFF;
    color: #000000;
  }
  
  a {
    color: color(links, default) !important;
    text-decoration: underline;
  }
}

// Tag page styles
.tag-page {
  max-width: 800px;
  margin: 0 auto;
  padding: 1em;
}

.tag-list {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  list-style: none;
  padding: 0;

  li { margin: 0.5em; }

  a {
    color: color(links, default);
    background-color: color(background);
    border: 1px solid color(links, default);
    border-radius: 0.25em;
    padding: 0.5em 1em;
    text-decoration: none;
    transition: background-color 0.3s ease, color 0.3s ease;

    &:hover, &:focus {
      background-color: color(links, default);
      color: color(background);
    }
  }
}

.tagged-posts {
  ul {
    list-style: none;
    padding-left: 0;
  }

  li { margin-bottom: 0.5em; }

  time {
    font-size: 0.9em;
    color: rgba(color(text), 0.7);
  }
}

.post-wrapper {
  word-wrap: break-word;
  overflow-wrap: break-word;
}

.post-title { color: color(links, default); }

.post-heading {
  .tags, .tag { color: color(accents, dodgerblue); }
  .info { color: rgba(color(text), 0.8); }

  a {
    color: color(accents, dodgerblue);
    text-decoration: none;

    &:hover { text-decoration: underline; }
  }
}

// Copy button styles
.code-container {
  position: relative;
}
